import path from "path";
import fs from "fs";
import { generateClientSchema } from "./nodes/client";

const configName = (process.argv.slice(2)[0]) || "rpc.json";

const configFile = path.join(process.cwd(), configName);



fs.stat(configFile, (err, stat) => {
    if (err) {
        console.error(err);
        return;
    }
    fs.readFile(configFile, (err, configData) => {
        if (err) {
            console.error(err);
            return;
        }

        const config = JSON.parse(configData.toString("utf8"));
        delete config.generator;
        console.log("Generating schema..");
        generateClientSchema(config).then((result) => {
            console.log("Schema Generated, Version", result.version);
        }).catch((e) => {
            console.log(e);
            throw e;
        });
    });
});
